<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPSC Todo App - Ashoka Stambh Theme</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #FF9933; /* Saffron */
            --secondary-color: #000080; /* Navy Blue */
            --success-color: #138808; /* Green */
            --white: #FFFFFF;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-gray: #f8f9fa;
            --dark-gray: #343a40;
            --border-radius: 8px;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            position: relative;
        }

        /* Background with Ashoka Stambh watermark */
        body::before {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Emblem_of_India.svg/800px-Emblem_of_India.svg.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.05;
            z-index: -1;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
            padding: 1rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo img {
            width: 50px;
            height: 50px;
            filter: brightness(0) invert(1);
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--white);
        }

        .btn-primary:hover {
            background: #e68a2e;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: var(--white);
        }
        
        .btn-success {
            background: var(--success-color);
            color: var(--white);
        }

        .btn-danger {
            background: var(--danger-color);
            color: var(--white);
        }

        /* Motivational Marquee Banner */
        .motivation-banner {
            background: var(--dark-gray);
            color: var(--white);
            padding: 0.6rem 0;
            overflow: hidden;
            white-space: nowrap;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .motivation-banner p {
            margin: 0;
            display: inline-block;
            will-change: transform;
            animation: marquee 30s linear infinite;
            font-size: 0.95rem;
            font-style: italic;
        }

        @keyframes marquee {
            from { transform: translateX(100vw); }
            to   { transform: translateX(-100%); }
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: var(--white);
            padding: 0.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: var(--dark-gray);
            transition: var(--transition);
            white-space: nowrap;
            border-radius: var(--border-radius);
        }

        .tab:hover {
            background: var(--light-gray);
        }

        .tab.active {
            background: var(--primary-color);
            color: var(--white);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .card h2 {
            margin-bottom: 1rem;
            color: var(--secondary-color);
        }

        /* Todo List Styles */
        .todo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .todo-filters {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .todo-form {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            color: var(--dark-gray);
        }

        .form-control {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 153, 51, 0.25);
        }

        .priority-select {
            display: flex;
            gap: 0.5rem;
        }

        .priority-option {
            flex: 1;
            padding: 0.5rem;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .priority-option:hover {
            border-color: var(--secondary-color);
        }

        .priority-option.selected {
            color: var(--white);
        }

        .priority-low.selected { background: #28a745; border-color: #28a745; }
        .priority-medium.selected { background: #ffc107; border-color: #ffc107; }
        .priority-high.selected { background: #fd7e14; border-color: #fd7e14; }
        .priority-urgent.selected { background: #dc3545; border-color: #dc3545; }

        /* Todo Items */
        .todo-list {
            display: grid;
            gap: 1rem;
        }
        
        .todo-placeholder {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            border: 2px dashed #dee2e6;
        }

        .todo-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--white);
            border-radius: var(--border-radius);
            transition: var(--transition);
            border-left: 5px solid transparent;
        }
        
        .todo-item[data-priority="low"] { border-left-color: #28a745; }
        .todo-item[data-priority="medium"] { border-left-color: #ffc107; }
        .todo-item[data-priority="high"] { border-left-color: #fd7e14; }
        .todo-item[data-priority="urgent"] { border-left-color: #dc3545; }

        .todo-item:hover {
            background: #e9ecef;
        }

        .todo-item.completed {
            opacity: 0.6;
        }

        .todo-item.completed .todo-text-content {
            text-decoration: line-through;
        }

        .todo-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .todo-text {
            flex: 1;
            font-size: 1rem;
        }
        
        .todo-text-content {
            font-weight: 500;
        }
        
        .todo-due-date {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 4px;
        }

        .todo-meta {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            font-size: 0.875rem;
            color: #666;
        }

        .priority-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-badge.low { background: #d4edda; color: #155724; }
        .priority-badge.medium { background: #fff3cd; color: #856404; }
        .priority-badge.high { background: #ffeeba; color: #856404; }
        .priority-badge.urgent { background: #f8d7da; color: #721c24; }
        
        .todo-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.25rem;
            color: #6c757d;
            transition: var(--transition);
        }
        
        .action-btn:hover {
            color: var(--danger-color);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--white);
            padding: 2rem;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-header h2 {
            margin: 0;
            color: var(--secondary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            line-height: 1;
        }

        /* Current Affairs */
        .affairs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .affair-card {
            border-left: 4px solid var(--primary-color);
            padding-left: 1rem;
        }
        
        .affair-card p {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #495057;
        }

        .affair-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--secondary-color);
        }

        .affair-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.875rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        /* Community Chat */
        .chat-container {
            height: 60vh;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            border: 1px solid #dee2e6;
        }

        .chat-message {
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .message-author {
            font-weight: 600;
            color: var(--primary-color);
        }

        .message-time {
            color: #666;
        }
        
        .message-body {
            color: #343a40;
        }

        .chat-input {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input input {
            flex: 1;
        }

        /* Profile Section */
        .profile-form {
            max-width: 600px;
        }

        /* Login/Signup */
        .auth-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            transition: opacity 0.5s ease;
        }

        .auth-card {
            background: var(--white);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 400px;
            width: 90%;
            animation: slideIn 0.5s ease;
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-logo img {
            width: 80px;
            height: 80px;
        }
        
        .auth-logo h2 {
            margin-top: 0.5rem;
            color: var(--secondary-color);
        }

        /* Main App Container */
        #main-app {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .tabs {
                padding-left: 1rem;
                padding-right: 1rem;
            }

            .affairs-grid {
                grid-template-columns: 1fr;
            }
            
            .todo-header {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* Loading Spinner */
        .spinner {
            display: none; /* Hidden by default */
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        .btn.loading .spinner {
            display: inline-block;
        }
        
        .btn.loading .btn-text {
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Privacy Notice */
        .privacy-notice {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1rem 1.5rem;
            margin-top: 2rem;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }
        
        .privacy-notice p {
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .privacy-notice a {
            color: #0d47a1;
            font-weight: 600;
            text-decoration: none;
        }
        
        .privacy-notice a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

    <div class="auth-container" id="auth-container">
        <div class="auth-card">
            <div class="auth-logo">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Emblem_of_India.svg/800px-Emblem_of_India.svg.png" alt="Ashoka Stambh">
                <h2>UPSC Path</h2>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="phone-number">Phone Number</label>
                    <input type="tel" id="phone-number" class="form-control" placeholder="Enter your 10-digit phone number" required>
                </div>
                <br>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span class="btn-text">Login / Signup</span>
                    <span class="spinner"></span>
                </button>
            </form>
        </div>
    </div>

    <div id="main-app">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Emblem_of_India.svg/800px-Emblem_of_India.svg.png" alt="Ashoka Stambh">
                    <h1>UPSC Path</h1>
                </div>
                <div class="nav-buttons">
                    <span id="welcome-message" style="font-size: 0.9rem;"></span>
                    <button class="btn btn-danger" id="logout-btn">Logout</button>
                </div>
            </div>
        </header>

        <div class="motivation-banner">
            <p id="quote-text">Loading daily motivation...</p>
        </div>

        <main class="container">
            <div class="tabs">
                <button class="tab active" data-tab="todo">📝 To-Do List</button>
                <button class="tab" data-tab="notes">🗒️ Notes</button>
                <button class="tab" data-tab="affairs">📰 Current Affairs</button>
                <button class="tab" data-tab="community">💬 Community</button>
                <button class="tab" data-tab="profile">👤 Profile</button>
                <button class="tab" data-tab="credits">🌟 Credits</button>
            </div>

            <div class="tab-content-wrapper">

                <div id="todo-tab" class="tab-content active">
                    <div class="card">
                        <div class="todo-header">
                            <h2>My Study Plan</h2>
                            <div class="todo-filters">
                                <select id="sort-todos" class="form-control">
                                    <option value="default">Sort by Default</option>
                                    <option value="priority">Sort by Priority</option>
                                    <option value="due-date">Sort by Due Date</option>
                                </select>
                                <button class="btn btn-success" id="add-task-btn">＋ Add Task</button>
                            </div>
                        </div>
                        <div class="todo-list" id="todo-list">
                            </div>
                         <div class="todo-placeholder" id="todo-placeholder">
                            <p>Your task list is empty. Click "Add Task" to get started!</p>
                        </div>
                    </div>
                </div>

                <div id="notes-tab" class="tab-content">
                    <div class="card">
                        <h2>My Notes</h2>
                        <div class="form-group">
                            <textarea id="notes-area" class="form-control" rows="15" placeholder="Write down your important notes, thoughts, and summaries here. Your notes will be saved automatically."></textarea>
                        </div>
                    </div>
                </div>
                
                <div id="affairs-tab" class="tab-content">
                     <div class="card">
                        <h2>Today's Key Current Affairs</h2>
                        <div class="affairs-grid" id="affairs-grid">
                           </div>
                    </div>
                </div>

                <div id="community-tab" class="tab-content">
                    <div class="card">
                        <h2>Aspirants' Community Chat</h2>
                        <div class="chat-container">
                            <div class="chat-messages" id="chat-messages">
                                <div class="chat-message">
                                    <div class="message-header">
                                        <span class="message-author">Admin</span>
                                        <span class="message-time">Just Now</span>
                                    </div>
                                    <p class="message-body">Welcome to the community! Feel free to discuss topics, ask questions, and motivate each other. Please maintain a respectful environment.</p>
                                </div>
                            </div>
                            <form class="chat-input" id="chat-form">
                                <input type="text" id="chat-message-input" class="form-control" placeholder="Type your message..." required>
                                <button type="submit" class="btn btn-primary">Send</button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <div id="profile-tab" class="tab-content">
                    <div class="card profile-form">
                         <h2>My Profile</h2>
                         <p style="margin-bottom: 1.5rem; color: #6c757d;">Keep your details updated to receive timely reminders for your tasks.</p>
                         <form id="profile-form">
                             <div class="form-group">
                                 <label for="profile-name">Full Name</label>
                                 <input type="text" id="profile-name" class="form-control" placeholder="Enter your full name">
                             </div>
                             <br>
                             <div class="form-group">
                                 <label for="profile-phone">Phone Number (for SMS reminders)</label>
                                 <input type="tel" id="profile-phone" class="form-control" placeholder="e.g., 9876543210" readonly>
                             </div>
                             <br>
                             <div class="form-group">
                                 <label for="profile-email">Email Address (for email reminders)</label>
                                 <input type="email" id="profile-email" class="form-control" placeholder="Enter your email address">
                             </div>
                             <br>
                             <button type="submit" class="btn btn-primary">Save Changes</button>
                         </form>
                    </div>
                </div>
                
                <div id="credits-tab" class="tab-content">
                    <div class="card">
                        <h2>Credits & Acknowledgements</h2>
                        <p>This application was designed to help UPSC aspirants on their path to success.</p>
                        <ul>
                            <li><strong>Iconography:</strong> Ashoka Stambh from Wikimedia Commons, licensed under public domain.</li>
                            <li><strong>Framework:</strong> Built with HTML, CSS, and vanilla JavaScript.</li>
                            <li><strong>Quotes API:</strong> <a href="https://type.fit/api/quotes" target="_blank">Type.fit</a></li>
                            <li><strong>Concept:</strong> Inspired by the dedication and hard work of millions of civil services aspirants in India.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="privacy-notice">
                <p><strong>Privacy & Awareness:</strong> Your data (tasks, notes, profile) is stored locally in your browser and is not uploaded to any server. For awareness, we encourage you to understand your rights under India's Digital Personal Data Protection Act, 2023. <a href="https://www.meity.gov.in/content/digital-personal-data-protection-act-2023" target="_blank" rel="noopener noreferrer">Learn more here.</a></p>
            </div>
        </main>
    </div>

    <div id="todo-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add New Task</h2>
                <button class="modal-close" id="modal-close-btn">&times;</button>
            </div>
            <form id="todo-form">
                <input type="hidden" id="todo-id">
                <div class="form-group">
                    <label for="todo-input">Task Description</label>
                    <input type="text" id="todo-input" class="form-control" placeholder="e.g., Read Chapter 5 of Indian Polity" required>
                </div>
                <div class="form-group">
                    <label for="todo-due-date">Due Date & Time (for reminders)</label>
                    <input type="datetime-local" id="todo-due-date" class="form-control">
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <div class="priority-select" id="priority-select">
                        <div class="priority-option priority-low" data-priority="low">Low</div>
                        <div class="priority-option priority-medium selected" data-priority="medium">Medium</div>
                        <div class="priority-option priority-high" data-priority="high">High</div>
                        <div class="priority-option priority-urgent" data-priority="urgent">Urgent</div>
                    </div>
                </div>
                <br>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Save Task</button>
            </form>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DOM ELEMENT SELECTORS ---
    const authContainer = document.getElementById('auth-container');
    const mainAppContainer = document.getElementById('main-app');
    const loginForm = document.getElementById('login-form');
    const logoutBtn = document.getElementById('logout-btn');
    const welcomeMessage = document.getElementById('welcome-message');

    const quoteTextElement = document.getElementById('quote-text');

    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    const todoList = document.getElementById('todo-list');
    const todoPlaceholder = document.getElementById('todo-placeholder');
    const addTaskBtn = document.getElementById('add-task-btn');
    const todoModal = document.getElementById('todo-modal');
    const modalCloseBtn = document.getElementById('modal-close-btn');
    const todoForm = document.getElementById('todo-form');
    const priorityOptions = document.querySelectorAll('.priority-option');
    const sortTodosSelect = document.getElementById('sort-todos');
    
    const notesArea = document.getElementById('notes-area');
    
    const affairsGrid = document.getElementById('affairs-grid');
    
    const chatForm = document.getElementById('chat-form');
    const chatMessages = document.getElementById('chat-messages');
    const chatMessageInput = document.getElementById('chat-message-input');
    
    const profileForm = document.getElementById('profile-form');
    const profileNameInput = document.getElementById('profile-name');
    const profilePhoneInput = document.getElementById('profile-phone');
    const profileEmailInput = document.getElementById('profile-email');

    // --- STATE MANAGEMENT ---
    let todos = JSON.parse(localStorage.getItem('todos')) || [];
    let userProfile = JSON.parse(localStorage.getItem('userProfile')) || { name: '', phone: '', email: '' };
    
    const currentAffairs = [
        { title: "Digital Personal Data Protection Act, 2023", date: "July 31, 2025", category: "Polity", summary: "The DPDP Act aims to establish a comprehensive legal framework for data protection in India, balancing the right to privacy with the need for lawful data processing. Key provisions include data fiduciary obligations, data principal rights, and the establishment of a Data Protection Board." },
        { title: "National Quantum Mission (NQM)", date: "July 30, 2025", category: "Science & Tech", summary: "The NQM has been approved with the goal of seeding, nurturing, and scaling up scientific and industrial R&D in Quantum Technology. This will position India as a global leader in the field, with applications in computing, communication, and sensing." },
        { title: "G20 Summit Outcomes", date: "July 29, 2025", category: "International Relations", summary: "Recent discussions focused on global economic stability, climate finance, and inclusive growth. The New Delhi Leaders' Declaration emphasized multilateral reforms and a human-centric approach to development." }
    ];

    // --- AUTHENTICATION ---
    const checkLogin = () => {
        if (userProfile.phone) {
            authContainer.style.display = 'none';
            mainAppContainer.style.display = 'block';
            profilePhoneInput.value = userProfile.phone;
            profileNameInput.value = userProfile.name;
            profileEmailInput.value = userProfile.email;
            welcomeMessage.textContent = `Welcome, ${userProfile.name || 'Aspirant'}!`;
        } else {
            authContainer.style.display = 'flex';
            mainAppContainer.style.display = 'none';
        }
    };

    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const phoneInput = document.getElementById('phone-number');
        const loginBtn = loginForm.querySelector('button');
        const spinner = loginBtn.querySelector('.spinner');
        const btnText = loginBtn.querySelector('.btn-text');
        
        spinner.style.display = 'inline-block';
        btnText.style.display = 'none';
        
        setTimeout(() => {
            userProfile.phone = phoneInput.value;
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            checkLogin();
            
            spinner.style.display = 'none';
            btnText.style.display = 'inline-block';
        }, 1000);
    });

    logoutBtn.addEventListener('click', () => {
        if (confirm('Are you sure you want to logout? Your data will remain in this browser.')) {
            userProfile.phone = '';
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            checkLogin();
        }
    });

    // --- MOTIVATIONAL BANNER ---
    const fetchAndDisplayQuote = async () => {
        try {
            const response = await fetch("https://type.fit/api/quotes");
            if (!response.ok) throw new Error('Network response was not ok.');
            const quotes = await response.json();
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            const author = quote.author && quote.author.toLowerCase() !== 'type.fit' ? quote.author : 'Anonymous';
            quoteTextElement.textContent = `"${quote.text}" — ${author}`;
        } catch (error) {
            console.error("Failed to fetch motivational quote:", error);
            quoteTextElement.textContent = '"Arise, awake, and stop not till the goal is reached." — Swami Vivekananda';
        }
    };

    // --- TAB SWITCHING LOGIC ---
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');

            const tabId = tab.getAttribute('data-tab');
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabId}-tab`) {
                    content.classList.add('active');
                }
            });
        });
    });

    // --- TO-DO LIST LOGIC ---
    const renderTodos = () => {
        todoList.innerHTML = '';
        if (todos.length === 0) {
            todoPlaceholder.style.display = 'block';
            todoList.style.display = 'none';
            return;
        }
        
        todoPlaceholder.style.display = 'none';
        todoList.style.display = 'grid';

        const sortedTodos = sortTodos(todos, sortTodosSelect.value);

        sortedTodos.forEach(todo => {
            const todoItem = document.createElement('div');
            todoItem.classList.add('todo-item');
            if (todo.completed) todoItem.classList.add('completed');
            todoItem.setAttribute('data-priority', todo.priority);

            const dueDate = todo.dueDate ? new Date(todo.dueDate) : null;
            const formattedDate = dueDate ? `${dueDate.toLocaleDateString()} at ${dueDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}` : 'No due date';

            todoItem.innerHTML = `
                <input type="checkbox" class="todo-checkbox" data-id="${todo.id}" ${todo.completed ? 'checked' : ''}>
                <div class="todo-text">
                    <span class="todo-text-content">${todo.text}</span>
                    <div class="todo-due-date">Due: ${formattedDate}</div>
                </div>
                <div class="todo-meta">
                    <span class="priority-badge ${todo.priority}">${todo.priority}</span>
                </div>
                <div class="todo-actions">
                    <button class="action-btn delete-btn" data-id="${todo.id}">&times;</button>
                </div>
            `;
            todoList.appendChild(todoItem);
        });
    };
    
    const sortTodos = (todos, criteria) => {
        const priorityOrder = { 'urgent': 4, 'high': 3, 'medium': 2, 'low': 1 };
        switch (criteria) {
            case 'priority':
                return [...todos].sort((a, b) => priorityOrder[b.priority] - priorityOrder[a.priority]);
            case 'due-date':
                return [...todos].sort((a, b) => (new Date(a.dueDate) || 0) - (new Date(b.dueDate) || 0));
            default:
                return todos;
        }
    };

    sortTodosSelect.addEventListener('change', renderTodos);

    const openModal = () => todoModal.classList.add('active');
    const closeModal = () => todoModal.classList.remove('active');

    addTaskBtn.addEventListener('click', () => {
        todoForm.reset();
        document.getElementById('todo-id').value = '';
        document.getElementById('modal-title').textContent = 'Add New Task';
        priorityOptions.forEach(opt => opt.classList.remove('selected'));
        priorityOptions[1].classList.add('selected');
        openModal();
    });

    modalCloseBtn.addEventListener('click', closeModal);
    window.addEventListener('click', (e) => e.target === todoModal && closeModal());

    priorityOptions.forEach(option => {
        option.addEventListener('click', () => {
            priorityOptions.forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
        });
    });

    todoForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const text = document.getElementById('todo-input').value.trim();
        const dueDate = document.getElementById('todo-due-date').value;
        const priority = document.querySelector('.priority-option.selected').dataset.priority;
        const id = document.getElementById('todo-id').value;

        if (text) {
            const newTodo = {
                id: Date.now(),
                text,
                dueDate,
                priority,
                completed: false
            };
            todos.push(newTodo);
            saveAndRender();
            closeModal();
        }
    });

    todoList.addEventListener('click', (e) => {
        if (e.target.classList.contains('delete-btn')) {
            const id = Number(e.target.dataset.id);
            todos = todos.filter(todo => todo.id !== id);
            saveAndRender();
        }
        if (e.target.classList.contains('todo-checkbox')) {
            const id = Number(e.target.dataset.id);
            const todo = todos.find(todo => todo.id === id);
            todo.completed = !todo.completed;
            saveAndRender();
        }
    });

    const saveAndRender = () => {
        localStorage.setItem('todos', JSON.stringify(todos));
        renderTodos();
    };
    
    // --- NOTES LOGIC ---
    notesArea.value = localStorage.getItem('userNotes') || '';
    notesArea.addEventListener('keyup', () => {
        localStorage.setItem('userNotes', notesArea.value);
    });

    // --- DYNAMIC CONTENT LOGIC ---
    const loadCurrentAffairs = () => {
        affairsGrid.innerHTML = '';
        currentAffairs.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card affair-card';
            card.innerHTML = `
                <h3 class="affair-title">${item.title}</h3>
                <div class="affair-meta">
                    <span>📅 ${item.date}</span>
                    <span><strong>Category:</strong> ${item.category}</span>
                </div>
                <p>${item.summary}</p>
            `;
            affairsGrid.appendChild(card);
        });
    };

    // --- COMMUNITY CHAT LOGIC ---
    chatForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const messageText = chatMessageInput.value.trim();
        if (messageText) {
            addChatMessage(userProfile.name || 'Anonymous', messageText);
            chatMessageInput.value = '';
        }
    });

    function addChatMessage(author, text) {
        const messageElement = document.createElement('div');
        messageElement.className = 'chat-message';
        messageElement.innerHTML = `
            <div class="message-header">
                <span class="message-author">${author}</span>
                <span class="message-time">${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>
            </div>
            <p class="message-body">${text}</p>
        `;
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // --- PROFILE LOGIC ---
    profileForm.addEventListener('submit', (e) => {
        e.preventDefault();
        userProfile.name = profileNameInput.value;
        userProfile.email = profileEmailInput.value;
        localStorage.setItem('userProfile', JSON.stringify(userProfile));
        welcomeMessage.textContent = `Welcome, ${userProfile.name || 'Aspirant'}!`;
        alert('Profile saved successfully!');
    });

    // --- INITIALIZATION ---
    checkLogin();
    fetchAndDisplayQuote();
    renderTodos();
    loadCurrentAffairs();
});
</script>

</body>
</html>